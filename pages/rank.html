<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>ğŸ† ç²¾é€²æ’è¡Œæ¦œ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: 'Noto Serif TC', serif;
      background: #fffdf6;
      padding: 2em;
      max-width: 960px;
      margin: auto;
    }
    h1, h2 {
      text-align: center;
      color: #5a3825;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 2em;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 0.7em;
      text-align: center;
    }
    th {
      background-color: #eee4d0;
    }
    .reset-btn {
      display: block;
      margin: auto;
      padding: 0.5em 1em;
      background-color: #946c45;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <h1>ğŸ† ç²¾é€²æ’è¡Œæ¦œ</h1>

  <h2>ğŸŒ¿ æœ€ä½³ç²¾é€²æ¦œï¼ˆç´¯ç©æ­£ç¢ºæ•¸ï¼‰</h2>
  <table id="topTable">
    <thead>
      <tr><th>æš±ç¨±</th><th>æ­£ç¢ºå¥æ•¸</th><th>ç¸½é¡Œæ•¸</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <h2>ğŸš€ å‹‡çŒ›ç²¾é€²æ¦œï¼ˆé€²æ­¥å¹…åº¦æœ€å¤§ï¼‰</h2>
  <table id="improveTable">
    <thead>
      <tr><th>æš±ç¨±</th><th>ç¬¬ä¸€æ¬¡åˆ†æ•¸</th><th>æœ€è¿‘åˆ†æ•¸</th><th>é€²æ­¥å€¼</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <button class="reset-btn" onclick="resetRecords()">æ¸…é™¤æ‰€æœ‰ç´€éŒ„</button>

  <script>
    const topTable = document.querySelector("#topTable tbody");
    const improveTable = document.querySelector("#improveTable tbody");

    function collectData(source) {
      const records = JSON.parse(localStorage.getItem(source) || "[]");
      const stats = {};

      records.forEach(r => {
        const name = r.name || "ç„¡åè¡Œè€…";
        if (!stats[name]) stats[name] = { correct: 0, total: 0, scores: [] };
        stats[name].correct += r.correct ? 1 : 0;
        stats[name].total += 1;
        stats[name].scores.push(r.correct ? 1 : 0);
      });

      return stats;
    }

    function loadRanking() {
      const allStats = [collectData("sentenceRecord"), collectData("vocabRecord")];

      const mergedStats = {};
      allStats.forEach(group => {
        for (const [name, stat] of Object.entries(group)) {
          if (!mergedStats[name]) mergedStats[name] = { correct: 0, total: 0, scores: [] };
          mergedStats[name].correct += stat.correct;
          mergedStats[name].total += stat.total;
          mergedStats[name].scores = mergedStats[name].scores.concat(stat.scores);
        }
      });

      // ğŸŒ¿ Best Performer
      const sorted = Object.entries(mergedStats).sort((a, b) => b[1].correct - a[1].correct);
      topTable.innerHTML = sorted.map(([name, stat]) =>
        `<tr><td>${name}</td><td>${stat.correct}</td><td>${stat.total}</td></tr>`).join("");

      // ğŸš€ Improvement
      const improved = Object.entries(mergedStats).map(([name, stat]) => {
        const scores = stat.scores;
        const first = scores[0] || 0;
        const last = scores[scores.length - 1] || 0;
        return { name, first, last, diff: last - first };
      }).sort((a, b) => b.diff - a.diff);

      improveTable.innerHTML = improved.map(s =>
        `<tr><td>${s.name}</td><td>${s.first}</td><td>${s.last}</td><td>${s.diff}</td></tr>`).join("");
    }

    function resetRecords() {
      if (confirm("ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰ç´€éŒ„ï¼Ÿé€™å°‡ç„¡æ³•å¾©åŸã€‚")) {
        localStorage.removeItem("sentenceRecord");
        localStorage.removeItem("vocabRecord");
        location.reload();
      }
    }

    loadRanking();
  </script>

</body>
</html>
