<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>ğŸ¥¦ è©å½™é…å°éŠæˆ²</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: 'Noto Serif TC', serif;
      padding: 2em;
      background: #fcfaf3;
      max-width: 960px;
      margin: auto;
    }
    h2, h3 {
      text-align: center;
      color: #5a3825;
    }
    .level-select {
      text-align: center;
      margin-bottom: 1.5em;
    }
    .game-container {
      display: flex;
      justify-content: space-between;
      gap: 2em;
      flex-wrap: wrap;
    }
    .column {
      width: 45%;
      min-width: 280px;
    }
    .drag-item, .drop-zone {
      background: #fff;
      padding: 0.8em 1em;
      margin: 0.5em 0;
      border: 2px dashed #ccc;
      border-radius: 8px;
      cursor: grab;
      text-align: center;
    }
    .drop-zone.over {
      border-color: #66a3ff;
      background-color: #f0faff;
    }
    .drop-zone.correct {
      background-color: #d6f5d6;
      border-color: green;
      font-weight: bold;
    }
    .used {
      display: none;
    }
    #hintBox {
      margin-top: 1em;
      font-size: 0.9em;
      color: #a15d00;
      font-weight: bold;
      text-align: center;
    }
    button {
      display: inline-block;
      margin: 1em auto;
      padding: 0.6em 1.2em;
      font-size: 1em;
      background: #946c45;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    .center {
      text-align: center;
    }
  </style>
</head>
<body>

  <h2>ğŸ¥¦ è©å½™é…å°éŠæˆ²</h2>
  <div class="level-select">
    <label for="levelSelect">é¸æ“‡é—œå¡ï¼š</label>
    <select id="levelSelect"></select>
    <button onclick="loadLevel()">é–‹å§‹é—œå¡</button>
  </div>

  <div class="game-container">
    <div class="column" id="dragArea"></div>
    <div class="column" id="dropArea"></div>
  </div>

  <div class="center">
    <button onclick="showHints()">ğŸ’¡ å·çœ‹æç¤ºï¼ˆæœƒæ‰£ç²¾é€²å€¼ï¼‰</button>
    <button onclick="resetGame()">ğŸ”„ é‡ä¾†</button>
  </div>
  <div id="hintBox"></div>

  <script src="../js/game-data.js"></script>
  <script>
    const dragArea = document.getElementById("dragArea");
    const dropArea = document.getElementById("dropArea");
    const levelSelect = document.getElementById("levelSelect");
    let currentPairs = [];
    let hintUsed = false;

    vocabGameLevels.forEach((level, idx) => {
      const opt = document.createElement("option");
      opt.value = idx;
      opt.textContent = level.level;
      levelSelect.appendChild(opt);
    });

    function loadLevel() {
      dragArea.innerHTML = "";
      dropArea.innerHTML = "";
      document.getElementById("hintBox").textContent = "";
      hintUsed = false;

      const levelIndex = levelSelect.value;
      currentPairs = vocabGameLevels[levelIndex].pairs;

      // shuffle pairs
      const shuffled = [...currentPairs].sort(() => Math.random() - 0.5);

      shuffled.forEach(pair => {
        const dragItem = document.createElement("div");
        dragItem.className = "drag-item";
        dragItem.textContent = pair.en;
        dragItem.id = pair.id;
        dragItem.draggable = true;

        dragItem.ondragstart = e => {
          e.dataTransfer.setData("text/plain", dragItem.id);
        };

        dragArea.appendChild(dragItem);

        const dropZone = document.createElement("div");
        dropZone.className = "drop-zone";
        dropZone.dataset.match = pair.id;
        dropZone.dataset.hint = pair.hint;
        dropZone.textContent = pair.zh;

        dropZone.ondragover = e => {
          e.preventDefault();
          dropZone.classList.add("over");
        };

        dropZone.ondragleave = () => {
          dropZone.classList.remove("over");
        };

        dropZone.ondrop = e => {
          e.preventDefault();
          const draggedId = e.dataTransfer.getData("text/plain");
          const draggedEl = document.getElementById(draggedId);

          if (dropZone.dataset.match === draggedId) {
            dropZone.textContent += " âœ…";
            dropZone.classList.add("correct");
            draggedEl.classList.add("used");
            speakWord(draggedEl.textContent);
            saveVocabScore({ correct: true });
          } else {
            alert("âŒ éŒ¯èª¤ï¼Œè«‹å†è©¦ä¸€æ¬¡");
            saveVocabScore({ correct: false });
          }

          dropZone.classList.remove("over");
        };

        dropArea.appendChild(dropZone);
      });
    }

    function speakWord(text) {
      const msg = new SpeechSynthesisUtterance(text);
      msg.lang = "en-US";
      speechSynthesis.speak(msg);
    }

    function showHints() {
      if (!hintUsed) {
        let output = "ğŸ“œ æç¤ºï¼š<br>";
        const zones = document.querySelectorAll(".drop-zone");
        zones.forEach(zone => {
          output += `ğŸ‘‰ ${zone.textContent.replace(" âœ…", "")}ï¼š${zone.dataset.hint}<br>`;
        });
        document.getElementById("hintBox").innerHTML = output + "âš ï¸ å·²ä½¿ç”¨æç¤ºï¼Œç²¾é€²å€¼ -1 ğŸ™ˆ";
        hintUsed = true;
      }
    }

    function resetGame() {
      loadLevel();
    }

    function saveVocabScore(record) {
      const name = localStorage.getItem("userName") || prompt("è«‹è¼¸å…¥ä½ çš„æš±ç¨±ï¼š");
      if (!name) return;
      localStorage.setItem("userName", name);
      const history = JSON.parse(localStorage.getItem("vocabRecord") || "[]");
      record.name = name;
      record.date = new Date().toISOString();
      history.push(record);
      localStorage.setItem("vocabRecord", JSON.stringify(history));
    }

    loadLevel();
  </script>

</body>
</html>
